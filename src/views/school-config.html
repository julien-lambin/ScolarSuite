<!DOCTYPE html>
<html lang="fr">
<head>
    <title>ScolarSuite - Configuration de l'√©cole</title>
    <!-- {{> _head.html }} -->
</head>
<body>
    <div class="app-layout">
        <nav class="sidebar">
            <!-- {{> _sidebar.html }} -->
        </nav>

        <main class="main-content">
            <header class="main-header">
                <!-- Titre √©ditable -->
                <div class="config-title-row" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <h1 style="margin: 0; white-space: nowrap;">Configuration :</h1>
                    <input type="text" id="school-name-input" class="school-name-input" value="Chargement..." style="font-size: 1.5rem; font-weight: 600; padding: 0.2rem 0.5rem; border: 1px solid transparent; background: transparent; width: 100%;">
                    
                    <!-- BOUTON IMPORT (Nouveau) -->
                    <button type="button" id="btn-open-import" class="btn-secondary" style="margin-left: auto;">üìÇ Importer une config...</button>
                </div>
                <style>
                    /* Style rapide pour l'input de titre */
                    .school-name-input:hover, .school-name-input:focus {
                        border-color: #ced4da !important;
                        background-color: #fff !important;
                        border-radius: 4px;
                    }
                </style>
            </header>
            
            <div class="content-body">
                <p class="intro-text">Configurez d'abord les produits vendus, puis le contenu technique des pochettes.</p>

                <form id="school-config-form">
                    
                    <!-- SECTION 1 : CATALOGUE VENTE -->
                    <section class="card">
                        <div class="card-header-flex">
                            <h2>1. Catalogue Produits (Vente au d√©tail)</h2>
                            <button type="button" id="add-product-btn" class="btn-primary small">+ Nouveau Produit</button>
                        </div>
                        
                        <div class="config-catalog-header">
                            <span>Produit</span>
                            <span>Dossier Source</span>
                            <span>Dossier Export (Vente seule)</span>
                            <span>Type</span>
                            <span>Prix (‚Ç¨)</span>
                            <span>Actif</span>
                            <span></span> <!-- 7√®me colonne vide pour l'alignement -->
                        </div>
                        <div id="product-list-container">
                            <!-- Liste g√©n√©r√©e par JS -->
                        </div>
                    </section>

                    <!-- SECTION 2 : COMPOSITION DES PACKS -->
                    <section class="card" id="packs-section">
                        <h2>2. Contenu des Pochettes compl√©tes</h2>
                        <p style="color: var(--text-muted-color); margin-bottom: 1rem; font-size: 0.9rem;">
                            D√©finissez ici quels fichiers sont copi√©s lorsqu'un client ach√®te une pochette compl√®te complet. 
                            Vous pouvez ajouter des √©l√©ments qui ne sont pas vendus seuls (ex: Pochette).
                        </p>
                        
                        <div id="packs-container">
                            <!-- Les conteneurs de chaque pack seront g√©n√©r√©s ici -->
                        </div>
                    </section>

                    <footer class="final-actions">
                        <!-- Zone de statut √† gauche (Cach√©e par d√©faut) -->
                        <div id="processing-status" class="footer-status" style="display: none;">
                            <span id="progress-text" class="status-label">Pr√©paration...</span> 
                            <progress id="config-progress-bar" value="0" max="100"></progress>
                        </div>
                        
                        <!-- Groupe de boutons √† droite -->
                        <div class="footer-buttons" style="display: flex; gap: 1rem; margin-left: auto;">
                            <button type="button" id="cancel-config-btn" class="btn-secondary">Annuler</button>
                            <button type="submit" class="btn-primary" style="min-width: 200px;">üíæ Enregistrer la Configuration</button>
                        </div>
                    </footer>
                </form>
            </div>
        </main>
    </div>

    <!-- MODALE IMPORT CONFIGURATION (Nouveau) -->
    <div id="import-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Importer une configuration</h3>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
                Choisissez une √©cole existante pour copier ses produits et tarifs.<br>
                Nous v√©rifierons si les dossiers correspondent.
            </p>
            
            <div class="form-group">
                <select id="import-school-select" style="width: 100%;">
                    <option value="">Chargement...</option>
                </select>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                <button type="button" id="btn-cancel-import" class="btn-secondary">Annuler</button>
                <button type="button" id="btn-confirm-import" class="btn-primary">Importer et Remplacer</button>
            </div>
        </div>
    </div>


    <!-- MODALE S√âLECTION PRODUIT -->
    <div id="product-picker-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 750px; max-height: 80vh; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin: 0;">Ajouter un produit</h3>
                <button type="button" id="btn-close-picker" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>

            <!-- Barre de recherche -->
            <div class="form-group">
                <input type="text" id="product-search-input" placeholder="üîç Rechercher par nom ou code (ex: P1824, Mug...)" autocomplete="off" style="width: 100%;">
            </div>

            <!-- Liste des r√©sultats (Scrollable) -->
            <div id="product-picker-list" style="flex-grow: 1; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; margin-bottom: 1rem; min-height: 200px;">
                <!-- Les items seront g√©n√©r√©s ici -->
            </div>

            <!-- Pied de page : Cr√©ation manuelle -->
            <div style="border-top: 1px solid #eee; padding-top: 1rem; text-align: center;">
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">Le produit n'existe pas ?</p>
                <button type="button" id="btn-create-custom-product" class="btn-secondary" style="width: 100%;">+ Cr√©er un produit vierge</button>
            </div>
        </div>
    </div>

    <script src="src/assets/js/school-config-renderer.js"></script>
</body>
</html>